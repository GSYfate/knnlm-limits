06/11/2024 01:33:25 - WARNING - __main__ - Process rank: 0, device: cpu, n_gpu: 1distributed training: True, 16-bits training: False
val dataset length is
146730
/home/sg2323/miniconda3/envs/faiss/lib/python3.9/site-packages/huggingface_hub/file_download.py:1132: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:43<01:26, 43.02s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [01:26<00:43, 43.15s/it]Loading checkpoint shards: 100%|██████████| 3/3 [02:05<00:00, 41.41s/it]Loading checkpoint shards: 100%|██████████| 3/3 [02:05<00:00, 41.87s/it]
device: cpu
1
text_column_name is text
06/11/2024 01:36:05 - WARNING - __main__ - The tokenizer picked seems to have a very large `model_max_length` (1000000000000000019884624838656). Picking 1024 instead. You can change that default value by passing --block_size xxx.
06/11/2024 01:47:27 - WARNING - accelerate.utils.other - Detected kernel version 5.4.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
06/11/2024 01:47:27 - INFO - knnlm3 - keytype being saved: KEY_TYPE.last_ffn_input
06/11/2024 01:47:27 - INFO - knnlm3 - Saving fp16
call get_model_last_layer
06/11/2024 01:47:27 - INFO - knnlm3 - Building index
06/11/2024 01:47:29 - INFO - knnlm3 - Adding Keys
06/11/2024 01:47:29 - INFO - knnlm3 - Adding Index 0
/home/sg2323/miniconda3/envs/faiss/lib/python3.9/site-packages/faiss/contrib/torch_utils.py:51: UserWarning: TypedStorage is deprecated. It will be removed in the future and UntypedStorage will be the only storage class. This should only matter to you if you are using storages directly.  To access UntypedStorage directly, use tensor.untyped_storage() instead of tensor.storage()
  x.storage().data_ptr() + x.storage_offset() * 4)
06/11/2024 01:58:57 - INFO - knnlm3 - Writing Index 0
06/11/2024 01:58:58 - INFO - knnlm3 - Adding Index 1000000
06/11/2024 02:10:26 - INFO - knnlm3 - Writing Index 1000000
06/11/2024 02:10:28 - INFO - knnlm3 - Adding Index 2000000
06/11/2024 02:22:00 - INFO - knnlm3 - Writing Index 2000000
06/11/2024 02:22:03 - INFO - knnlm3 - Adding Index 3000000
06/11/2024 02:33:33 - INFO - knnlm3 - Writing Index 3000000
06/11/2024 02:33:36 - INFO - knnlm3 - Adding Index 4000000
06/11/2024 02:45:06 - INFO - knnlm3 - Writing Index 4000000
06/11/2024 02:45:10 - INFO - knnlm3 - Adding Index 5000000
06/11/2024 02:56:38 - INFO - knnlm3 - Writing Index 5000000
06/11/2024 02:56:43 - INFO - knnlm3 - Adding Index 6000000
06/11/2024 03:08:12 - INFO - knnlm3 - Writing Index 6000000
06/11/2024 03:08:17 - INFO - knnlm3 - Adding Index 7000000
06/11/2024 03:19:43 - INFO - knnlm3 - Writing Index 7000000
06/11/2024 03:19:49 - INFO - knnlm3 - Adding Index 8000000
06/11/2024 03:31:19 - INFO - knnlm3 - Writing Index 8000000
06/11/2024 03:31:25 - INFO - knnlm3 - Adding Index 9000000
06/11/2024 03:42:56 - INFO - knnlm3 - Writing Index 9000000
06/11/2024 03:43:03 - INFO - knnlm3 - Adding Index 10000000
06/11/2024 03:54:33 - INFO - knnlm3 - Writing Index 10000000
06/11/2024 03:54:41 - INFO - knnlm3 - Adding Index 11000000
06/11/2024 04:06:11 - INFO - knnlm3 - Writing Index 11000000
06/11/2024 04:06:20 - INFO - knnlm3 - Adding Index 12000000
06/11/2024 04:17:52 - INFO - knnlm3 - Writing Index 12000000
06/11/2024 04:18:01 - INFO - knnlm3 - Adding Index 13000000
06/11/2024 04:29:35 - INFO - knnlm3 - Writing Index 13000000
06/11/2024 04:29:45 - INFO - knnlm3 - Adding Index 14000000
06/11/2024 04:41:17 - INFO - knnlm3 - Writing Index 14000000
06/11/2024 04:41:28 - INFO - knnlm3 - Adding Index 15000000
06/11/2024 04:52:58 - INFO - knnlm3 - Writing Index 15000000
06/11/2024 04:53:10 - INFO - knnlm3 - Adding Index 16000000
06/11/2024 05:04:40 - INFO - knnlm3 - Writing Index 16000000
06/11/2024 05:04:52 - INFO - knnlm3 - Adding Index 17000000
06/11/2024 05:16:17 - INFO - knnlm3 - Writing Index 17000000
06/11/2024 05:16:30 - INFO - knnlm3 - Adding Index 18000000
06/11/2024 05:27:55 - INFO - knnlm3 - Writing Index 18000000
06/11/2024 05:28:09 - INFO - knnlm3 - Adding Index 19000000
06/11/2024 05:39:34 - INFO - knnlm3 - Writing Index 19000000
06/11/2024 05:39:48 - INFO - knnlm3 - Adding Index 20000000
06/11/2024 05:51:17 - INFO - knnlm3 - Writing Index 20000000
06/11/2024 05:51:32 - INFO - knnlm3 - Adding Index 21000000
06/11/2024 06:02:59 - INFO - knnlm3 - Writing Index 21000000
06/11/2024 06:03:15 - INFO - knnlm3 - Adding Index 22000000
06/11/2024 06:14:40 - INFO - knnlm3 - Writing Index 22000000
06/11/2024 06:14:57 - INFO - knnlm3 - Adding Index 23000000
06/11/2024 06:26:21 - INFO - knnlm3 - Writing Index 23000000
06/11/2024 06:26:38 - INFO - knnlm3 - Adding Index 24000000
06/11/2024 06:38:02 - INFO - knnlm3 - Writing Index 24000000
06/11/2024 06:38:20 - INFO - knnlm3 - Adding Index 25000000
06/11/2024 06:49:44 - INFO - knnlm3 - Writing Index 25000000
06/11/2024 06:50:02 - INFO - knnlm3 - Adding Index 26000000
06/11/2024 07:01:30 - INFO - knnlm3 - Writing Index 26000000
06/11/2024 07:01:49 - INFO - knnlm3 - Adding Index 27000000
06/11/2024 07:13:14 - INFO - knnlm3 - Writing Index 27000000
06/11/2024 07:13:34 - INFO - knnlm3 - Adding Index 28000000
06/11/2024 07:24:58 - INFO - knnlm3 - Writing Index 28000000
06/11/2024 07:25:18 - INFO - knnlm3 - Adding Index 29000000
06/11/2024 07:36:43 - INFO - knnlm3 - Writing Index 29000000
06/11/2024 07:37:04 - INFO - knnlm3 - Adding Index 30000000
06/11/2024 07:48:28 - INFO - knnlm3 - Writing Index 30000000
06/11/2024 07:48:49 - INFO - knnlm3 - Adding Index 31000000
06/11/2024 08:00:17 - INFO - knnlm3 - Writing Index 31000000
06/11/2024 08:00:40 - INFO - knnlm3 - Adding Index 32000000
06/11/2024 08:12:05 - INFO - knnlm3 - Writing Index 32000000
06/11/2024 08:12:28 - INFO - knnlm3 - Adding Index 33000000
06/11/2024 08:23:57 - INFO - knnlm3 - Writing Index 33000000
06/11/2024 08:24:21 - INFO - knnlm3 - Adding Index 34000000
script/build2.sh: line 9: 3657645 Killed                  python -u run_clm3.py --model_name_or_path ${MODEL} --dataset_name wentingzhao/knn-prompt-datastore --per_device_eval_batch_size 8 --output_dir /share/rush/datastore/knn-prompt/${MODEL} --dstore_dir /share/rush/datastore/knn-prompt/${MODEL} --dstore_size 576872732 --build_index
slurmstepd: error: Detected 1 oom-kill event(s) in StepId=4026569.batch. Some of your processes may have been killed by the cgroup out-of-memory handler.
